digraph AnimalStateUpdate_Acyclic {
    // Configuración general
    graph [rankdir=TB, splines=polyline, nodesep=0.6, ranksep=0.5];
    node [fontname="Arial", fontsize=10, shape=box, style="filled,rounded", fillcolor="#F5F5F5", color="#333333"];
    edge [fontname="Arial", fontsize=9, color="#555555"];

    // Nodos de Inicio y Fin
    Start [label="Inicio: Actualizar Estado Wolf", shape=ellipse, fillcolor="#E1F5FE", style=filled];
    
    // Decisión Principal
    StateDecider [shape=diamond, label="Estado Actual?", style=filled];

    Start -> StateDecider;

    // ================= NORMAL =================
    subgraph cluster_normal_flow {
	label = "Estado: NORMAL";
        style=filled;
        color="#f1f8e9";

	subgraph cluster_normal_flow_1 {
	  label = "(1)";
          style=filled;
          color="#00f8e9";

	  N_1_i [label="i: la distancia del \n animal al destino \n es menor que 8.0?", shape=diamond];
	  N_1_i_yes [label="i: Elegir otro destino \l de manera aleatoria"];
	  N_1_ii [label="1.ii - 1.v"];

	  N_1_i -> N_1_i_yes [label="Sí"]
	  N_1_i -> N_1_ii [label="No"]
	  N_1_i_yes -> N_1_ii 
       }  

      subgraph cluster_normal_flow_2 {
	  label = "(2)";
          style=filled;
          color="#00f8e9";

	  N_2_i [label="i: su energía es \n menor que 50.0?", shape=diamond];
	  N_2_i_yes [label="i: cambia de estado a HUNGER"];
	  N_2_ii_b [label="ii: su deseo mayor de 65.0?", shape=diamond];
	  N_2_ii_c [label="ii: cambiar el estado a MATE"];

	  N_2_i -> N_2_i_yes [label="Sí"]
	  N_2_i -> N_2_ii_b [label="No"]
	  N_2_ii_b -> N_2_ii_c [label="Sí"]
	  
       }

       N_end [label="Fin Estado Normal"];

       N_1_ii -> N_2_i
       N_2_i_yes -> N_end
       N_2_ii_b -> N_end [label="No"]
       N_2_ii_c -> N_end
       
    }

    // ================= HUNGER =================
    subgraph cluster_hunger_flow {
        label="Estado: HUNGER"; color=none; 
        style=filled;
        color="#f1f8e9";

	subgraph cluster_hunger_flow_1 {
	  label = "(1)";
          style=filled;
          color="#00f8e9";

	  H_1 [label="1: huntTarget es null, o \n huntTarget no es null \n y su estado es DEAD o \n está fuera del campo visual?", shape=diamond];
	  H_1_a [label="1: buscar otro animal para cazarlo"];

	  H_1 -> H_1_a [label="Sí"]
       }  

	subgraph cluster_hunger_flow_2 {
	  label = "(2)";
          style=filled;
          color="#00f8e9";

	  H_2 [label="2: huntTarget \n es null", shape=diamond];
	  H_2_a [label="2: Avanza"];
	  H_2_b [label="2.i - 2.v"];
	  H_2_c [label="2.vi: la distancia del \n animal a huntTarget \n es menor que 8.0?"]
	  H_2_d [label="2.vi.a - 2.vi.c"];
	  
	  H_2 -> H_2_a [label="Sí"]
	  H_2 -> H_2_b [label="No"]
	  H_2_b ->  H_2_c
	  H_2_c -> H_2_d [label="Sí"]
	  
       }  

       subgraph cluster_hunger_flow_3 {
	  label = "(3)";
          style=filled;
          color="#00f8e9";

	  H_3   [label="i: su energía \n es mayor que 50.0?", shape=diamond]
	  H_3_a [label="i.a: su deseo es \n menor que 65.0?", shape=diamond]
	  H_3_b [label="i.a: cambia el estado a NORMAL"]
	  H_3_c [label="i.a: cambia el estado a MATE"]

	  H_3 -> H_3_a [label="Sí"]
	  H_3_a -> H_3_b [label="Sí"]
	  H_3_a -> H_3_c [label="No"]
      }

       H_end [label="Fin Estado HUNGER"];

       H_1 -> H_2 [label="No"]
       H_1_a -> H_2

       H_2_a -> H_3
       H_2_d -> H_3
       H_2_c -> H_3 [label="No"]

       H_3 -> H_end [label="No"]
       H_3_b -> H_end 
       H_3_c -> H_end
    }

    // ================= MATE =================
    subgraph cluster_mate_flow {
        label="Estado: MATE"; color=none; 
        style=filled;
        color="#f1f8e9";

	subgraph cluster_mate_flow_1 {
	  label = "(1)";
          style=filled;
          color="#00f8e9";

	  M_1 [label="1: mateTarget no es \n null y su estado es DEAD \n o está fuera del \n campo visual?", shape=diamond];
	  M_1_a [label="1: poner mateTarget a null"];

	  M_1 -> M_1_a [label="Sí"]
       }  

	subgraph cluster_mate_flow_2 {
	  label = "(2)";
          style=filled;
          color="#00f8e9";

	  M_2 [label="2: mateTarget es null?", shape=diamond];
	  M_2_a [label="2: buscar un animal para emparejarse"];
	  M_2_b [label="2: mateTarget es null?", shape=diamond];
	  M_2_c [label="2: Avanza"];
	  M_2_d [label="2.i - 2.v"];
	  M_2_e [label="vi :la distancia del \n animal a mateTarget \n es menor que 8.0?", shape=diamond];
	  M_2_f [label="2.vi.a: Resetear el deseo del animal \l y del mateTarget a 0.0"];
	  M_2_g [label="2.vi.b: lleva un bebé ya?", shape=diamond];
	  M_2_h [label="2.vi.b: con probabilidad \l de 0.9 va a llevar a \l un nuevo bebé usando \l new Wolf(this, mateTarget)"];
	  M_2_i [label="2.vi.c: Quitar 10.0 de la energía"];
	  M_2_ii [label="2.vi.d: Poner mateTarget a null"];
	  
	  M_2 -> M_2_a [label="Sí"]
	  M_2_a -> M_2_b 
	  M_2_b -> M_2_c [label="Sí"]
	  M_2 -> M_2_d [label="No"]
	  M_2_d -> M_2_e
	  M_2_e -> M_2_f [label="Sí"]
	  M_2_f -> M_2_g
	  M_2_g -> M_2_h [label="No"]
	  M_2_g -> M_2_i [label="Sí"]
	  M_2_h -> M_2_i
	  M_2_i -> M_2_ii

       }  

       subgraph cluster_mate_flow_3 {
          label = "(3)";
          style=filled;
          color="#00f8e9";

	  M_3 [label="3: su energía es \n menor que 50.0?", shape=diamond];
	  M_3_a [label="3: cambia de estado a HUNGER"];
	  M_3_b [label="3: su deseo es \n menor que 65.0?", shape=diamond];
	  M_3_c [label="3: cambia de estado a NORMAL"];

	  M_3 -> M_3_a [label="Sí"]
	  M_3 -> M_3_b [label="No"]
	  M_3_b -> M_3_c [label="Sí"]
	  
       }


       M_end [label="Fin Estado MATE"];

       M_1_a -> M_2
       M_1 -> M_2 [label="No"]
       M_2_b -> M_3   [label="No"]
       M_2_c -> M_3  
       M_2_e -> M_3   [label="No"]
       M_2_ii -> M_3
       M_3_b -> M_end [label="No"]
       M_3_a -> M_end
       M_3_c -> M_end
   }

    StateDecider -> N_1_i [label="NORMAL"]
    StateDecider -> H_1 [label="HUNGER"]
    StateDecider -> M_1 [label="MATE"]
}
